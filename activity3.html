<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Activity 3 â€” Under Pressure (Magma, Temperature & Gas)</title>

<style>
/* ---- CSS SAME AS YOUR VERSION ABOVE ---- */
/* I did not rewrite everything here to keep message short.
   You will paste your EXACT CSS from your message.
   Only JS portion needed completion. */
</style>
</head>
<body>

<!-- ---- HTML SAME AS YOUR VERSION ABOVE ---- -->
<!-- Paste your same exact HTML here -->

<script>
// DOM refs
const tempRange = document.getElementById('tempRange');
const tempLabel = document.getElementById('tempLabel');
const viscText = document.getElementById('viscText');
const gasText = document.getElementById('gasText');
const pressureFill = document.getElementById('pressureFill');
const pressurePct = document.getElementById('pressurePct');
const lavaStem = document.getElementById('lavaStem');
const lavaFlow = document.getElementById('lavaFlow');
const bubbles = document.getElementById('bubbles');
const viscBadge = document.getElementById('viscBadge');

let bubbleTimer = null;

// map
function mapRange(v, a, b, c, d) {
  return c + (d - c) * ((v - a) / (b - a));
}

function updateFromTemp(t){
  tempLabel.textContent = Math.round(t);

  // viscosity
  const viscosityIndex = 1 - (t/100);
  const viscLabel = viscosityIndex > 0.66 ? "High (Thick)" :
                    viscosityIndex < 0.33 ? "Low (Thin)" :
                    "Medium";
  viscText.textContent = viscLabel;
  viscBadge.textContent = viscLabel;

  // gas pressure
  const pressurePercent = Math.round(mapRange(t, 0, 100, 10, 95));
  pressureFill.style.width = pressurePercent + "%";
  pressureFill.style.background = `linear-gradient(90deg, ${
      pressurePercent>60 ? '#f94144' : '#ffd166'
  }, #ff6b6b)`;
  pressurePct.textContent = pressurePercent + "%";
  gasText.textContent = pressurePercent > 66 ? "High" :
                        pressurePercent < 33 ? "Low" : "Medium";

  // lava stem
  const stemHeight = Math.round(mapRange(t, 0, 100, 80, 10));
  lavaStem.style.height = stemHeight + "px";

  // lava flow
  const flowOpacity = mapRange(t, 0, 100, 0.08, 0.98);
  const flowHeight = Math.round(mapRange(t, 0, 100, 40, 160));
  const flowWidth  = Math.round(mapRange(t, 0, 100, 58, 32));

  lavaFlow.style.opacity = flowOpacity;
  lavaFlow.style.height = flowHeight + "px";
  lavaFlow.style.width  = flowWidth + "px";
  lavaFlow.style.borderRadius = Math.max(10, Math.round(flowWidth/2)) + "px";

  // lava color
  const warm = Math.round(mapRange(t, 0, 100, 40, 255));
  lavaStem.style.background = `linear-gradient(rgb(${warm},90,20), rgb(${warm-30},20,0))`;
  lavaFlow.style.background = `linear-gradient(#ffb37a, rgb(${warm},60,20) 70%)`;

  // bubbles
  setupBubbles(t, pressurePercent, viscosityIndex);
}

function clearBubbles(){
  if(bubbleTimer){ clearInterval(bubbleTimer); bubbleTimer = null; }
  bubbles.innerHTML = "";
}

function spawnBubble(temp, pressure, viscosityIndex){
  const el = document.createElement("div");
  el.className = "bubble";

  // size
  const size = Math.round(mapRange(temp, 0, 100, 14, 6));
  el.style.width = size + "px";
  el.style.height = size + "px";

  // left-right drift
  const drift = Math.round((Math.random() - 0.5) * 60);
  el.style.setProperty("--drift", drift + "px");

  // speed
  const dur = mapRange(temp, 0, 100, 4200, 900);
  el.style.animationDuration = (dur/1000) + "s";

  // random horizontal start
  const offset = (Math.random() - 0.5) * 80;
  el.style.left = (50 + offset/1.6) + "%";

  bubbles.appendChild(el);

  // remove bubble after animation
  setTimeout(() => el.remove(), dur + 200);
}

function setupBubbles(temp, pressurePercent, viscosityIndex){
  clearBubbles();

  // hotter = more bubbles  
  const freq = Math.round(mapRange(temp, 0, 100, 1600, 260));

  // spawn bubbles repeatedly
  bubbleTimer = setInterval(() => {
    const clusterCount = Math.round(mapRange(temp, 0, 100, 1, 4));  
    for(let i=0;i<clusterCount;i++){
      setTimeout(() => spawnBubble(temp, pressurePercent, viscosityIndex), i*80);
    }
  }, freq);
}

// event listener
tempRange.addEventListener("input", (e) => {
  updateFromTemp(Number(e.target.value));
});

// initialize
updateFromTemp(Number(tempRange.value));
</script>

</body>
</html>
