<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Activity 3 — Under Pressure (Magma, Temperature & Gas)</title>

<style>
  :root{
    --bg-url: url("/mnt/data/c30f4868-d4ee-479a-b24b-99377afc08dd.png");
    --page-bg: #cfeff2;
    --panel-bg: rgba(255,255,255,0.92);
    --accent: #e85d04;
    --cool: #2b7a78;
    --hot: #f94144;
    --bubble-color: rgba(255,255,255,0.9);
    --lava-color-1: #ff7a18;
    --lava-color-2: #ff2d00;
    --gauge-color: #ffb703;
  }

  *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
  body{
    margin:0;
    min-height:100vh;
    background:
      radial-gradient(circle at 20% 10%, rgba(255,255,255,0.25), transparent 15%),
      linear-gradient(180deg,#e0fbfc, #cfeff2 60%);
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px;
    gap:24px;
  }

  .app {
    width:100%;
    max-width:1100px;
    display:grid;
    grid-template-columns: 320px 1fr;
    gap:20px;
    align-items:start;
  }

  /* LEFT PANEL - Controls & info */
  .panel {
    background:var(--panel-bg);
    border-radius:12px;
    padding:16px;
    box-shadow:0 8px 30px rgba(12,18,20,0.06);
  }

  h1{font-size:20px;margin:0 0 10px}
  p.lead{margin:6px 0 14px;color:#234}

  .therm-row{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:12px;
  }
  .therm {
    transform: rotate(-90deg);
    width: 180px;
    height: 40px;
    --thumb-size:18px;
  }
  input[type=range]{
    -webkit-appearance:none;
    width:100%;
    height:8px;
    border-radius:8px;
    background:linear-gradient(90deg,#8ecae6, #023047);
    outline:none;
  }
  input[type=range]::-webkit-slider-thumb{
    -webkit-appearance:none;
    width:18px;height:18px;border-radius:50%;
    background:linear-gradient(#fff,#ddd);
    border:2px solid rgba(0,0,0,0.18);
    box-shadow:0 2px 4px rgba(0,0,0,0.15);
  }

  .stat {
    margin-top:12px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  .stat .box{
    background:#fff;border-radius:8px;padding:10px;text-align:center;box-shadow:0 6px 14px rgba(2,6,23,0.04);
  }
  .stat .box strong{display:block;font-size:18px}

  .gauge {
    margin-top:14px;
    display:flex;
    align-items:center;
    gap:12px;
  }
  .gauge .meter {
    width:100%;
    height:12px;
    background:linear-gradient(90deg,#eee,#ddd);
    border-radius:8px;
    overflow:hidden;
  }
  .gauge .meter > i {
    display:block;height:100%;
    width:20%;
    background:linear-gradient(90deg,var(--gauge-color), #f94144);
    transition:width .25s linear, background .25s;
  }
  .help {font-size:13px;color:#333;margin-top:12px;line-height:1.4}

  /* RIGHT PANEL - Visualization */
  .viz {
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.86));
    border-radius:12px;padding:18px; min-height:520px;
    display:flex;align-items:center;justify-content:center; position:relative; overflow:hidden;
    box-shadow:0 8px 30px rgba(12,18,20,0.06);
  }
  #volcanoImg {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 320px;      /* adjust size as needed */
  height: auto;
  pointer-events: none;
  z-index: 10;
}
/* Hide the old shape if still present */
.mount {
  background: linear-gradient(#7A7A7A, #4F4F4F);
  clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
}

  /* Decorative background - user uploaded image used as background */
  .scene {
    width:100%;
    max-width:740px;
    height:460px;
    border-radius:10px;
    position:relative;
    overflow:hidden;
    background-image: var(--bg-url);
    background-size:cover;
    background-position:center right;
    box-shadow: inset 0 30px 120px rgba(0,0,0,0.12);
  }

  /* Volcano area */
  .ground {
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom:36px;
    width:420px;
    height:220px;
    display:flex;align-items:flex-end;justify-content:center;
    pointer-events:none;
  }

  /* Mountain silhouette */
  .mount {
    position:relative;
    width:320px;height:200px;
    background:linear-gradient(#6fa3d1,#3a6fa8);
    clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
    box-shadow:0 30px 50px rgba(0,0,0,0.18) inset;
  }

  /* light streaks */
  .mount .streak{ position:absolute; background: rgba(255,255,255,0.25); filter:blur(2px); border-radius:20px;}
  .s1{width:180px;height:30px; top:80px; left:10px; transform:rotate(-8deg)}
  .s2{width:120px;height:22px; top:110px; left:70px; transform:rotate(-6deg)}
  .s3{width:80px;height:18px; top:140px; left:110px; transform:rotate(-4deg)}

  /* Crater */
  .crater {
    position:absolute;
    width:60px;height:24px;border-radius:50%;
    background: linear-gradient(#14232f,#0e2a3f);
    top:6px;left:50%; transform:translateX(-50%);
    box-shadow: 0 -8px 10px rgba(0,0,0,0.45);
  }

  /* Lava stem (base animation modified by temperature) */
  .lava-stem {
    position:absolute; left:50%; transform:translateX(-50%); bottom:36px;
    width:28px; height:26px; border-radius:50%;
    background:linear-gradient(#ff7a18,#ff2d00);
    opacity:0; transition: all .2s linear;
    box-shadow:0 4px 18px rgba(255,60,10,0.45);
  }

  /* Thin lava flowing overlay (longer smoother stream) */
  .lava-flow {
    position:absolute; left:50%; transform:translateX(-50%); bottom:56px;
    width:40px; height:120px; border-radius:20px;
    background: linear-gradient(#ffb37a, #ff4b24 70%);
    opacity:0; transition:opacity .25s;
    filter: blur(0.6px);
    transform-origin: top;
  }

  /* Bubbles container */
  .bubbles {
    position:absolute; left:50%; transform:translateX(-50%); bottom:90px;
    width:120px; height:140px; pointer-events:none; overflow:visible;
  }

  .bubble {
    position:absolute;
    bottom:0;
    left:50%;
    transform:translateX(-50%) translateY(0) scale(1);
    width:10px;height:10px;border-radius:50%;
    background:var(--bubble-color);
    opacity:0.95;
    box-shadow:0 1px 6px rgba(0,0,0,0.12);
    animation: bubbleRise linear forwards;
  }

  @keyframes bubbleRise {
    to { transform: translateX(calc(-50% + var(--drift, 0px))) translateY(-160px) scale(0.6); opacity:0; }
  }

  /* Labels under scene */
  .labels {
    position:absolute; bottom:6px; left:6px; color:#05386b; font-weight:600;
    background: rgba(255,255,255,0.6); padding:6px 8px; border-radius:8px;
    font-size:14px;
  }

  /* small responsive */
  @media (max-width:980px){
    .app{grid-template-columns:1fr; padding:12px}
    .scene{height:380px}
    .ground{width:320px}
  }

  /* --- CLASSIC VERTICAL THERMOMETER --- */

.classic-thermo-container {
  margin-top: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
}

/* Thermometer body */
.classic-thermo {
  position: relative;
  width: 40px;
  height: 200px;
  background: #fafafa;
  border: 4px solid #999;
  border-radius: 25px;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  overflow: hidden;
  box-shadow: inset 0 0 12px rgba(0,0,0,0.25);
}

/* Mercury that rises */
.classic-mercury {
  position: absolute;
  bottom: 25px; /* leaves space for bottom bulb */
  width: 100%;
  height: 0%;
  background: #c70000;
  border-radius: 20px;
  transition: height 0.4s ease;
  box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
}

/* Bottom bulb */
.classic-bulb {
  position: absolute;
  bottom: -10px;
  width: 55px;
  height: 55px;
  background: #d10000;
  border: 4px solid #999;
  border-radius: 50%;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.6);
}

/* Scale numbers */
.classic-scale {
  height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  font-size: 13px;
  font-weight: bold;
  color: #444;
}


</style>
</head>
<body>

<div class="app">
  <!-- Left: Controls -->
  <div class="panel">
    <h1>Activity 3 — Under Pressure</h1>
    <p class="lead">Drag the thermometer to change temperature. Watch how magma, bubbles and gas pressure react.</p>

    <label style="display:block;font-weight:600;margin-bottom:8px">Temperature</label>
    <!-- slider 0 = cold, 100 = hot -->
    <input id="tempRange" type="range" min="0" max="100" value="50" style="width:100%;">

    <div class="stat">
      <div class="box">
        <small>Viscosity</small>
        <strong id="viscText">Medium</strong>
        <span style="display:block;font-size:12px;margin-top:6px;color:#444">Thin ↔ Thick</span>
      </div>
      <div class="box">
        <small>Gas Pressure</small>
        <strong id="gasText">Medium</strong>
        <span style="display:block;font-size:12px;margin-top:6px;color:#444">Low ↔ High</span>
      </div>
    </div>

    <div class="gauge" style="margin-top:14px">
      <div style="width:90px;font-size:13px;color:#333; font-weight:600">Pressure</div>
      <div class="meter" aria-hidden="true"><i id="pressureFill" style="width:50%"></i></div>
      <div style="width:40px;text-align:right;font-weight:700;color:#333" id="pressurePct">50%</div>
    </div>

    <div class="help">
      <strong>How to interpret:</strong>
      <ul style="margin:8px 0 0 16px;padding:0;line-height:1.4;text-align:left">
        <li><strong>High temperature</strong> → magma is <em>thin and runny</em>; bubbles form easily → <em>higher gas pressure</em>.</li>
        <li><strong>Low temperature</strong> → magma is <em>thick and sticky</em>; bubbles are fewer → <em>lower gas pressure</em>.</li>
      </ul>
    </div>
  </div>

  <!-- Right: Visualization -->
  <div class="viz panel">
    <div class="classic-thermo-container">
  <div class="classic-thermo">
    <div class="classic-mercury" id="classicMercury"></div>
    <div class="classic-bulb"></div>
  </div>

  <div class="classic-scale">
    <span>100°</span>
    <span>75°</span>
    <span>50°</span>
    <span>25°</span>
    <span>0°</span>
  </div>
</div>

    <div class="scene" id="scene">
      <div class="ground">
      <div class="mount">
          <img id="volcanoImg" src="https://rjhae05.github.io/perciaolivaemodule/assets/Volcano.png" alt="Volcano" />
          <div class="lava-stem" id="lavaStem"></div>
          <div class="lava-flow" id="lavaFlow"></div>
          <div class="bubbles" id="bubbles"></div>
        </div>
      </div>

      <div class="labels">
        Temp: <span id="tempLabel">50</span> • Viscosity: <span id="viscBadge">Medium</span>
      </div>
    </div>
  </div>
</div>

<script>
// ---------------------------------------------------
// DOM REFERENCES
// ---------------------------------------------------
const tempRange = document.getElementById('tempRange');
const tempLabel = document.getElementById('tempLabel');

const viscText = document.getElementById('viscText');
const gasText = document.getElementById('gasText');

const pressureFill = document.getElementById('pressureFill');
const pressurePct = document.getElementById('pressurePct');

const lavaStem = document.getElementById('lavaStem');
const lavaFlow = document.getElementById('lavaFlow');

const bubbles = document.getElementById('bubbles');
const viscBadge = document.getElementById('viscBadge');

// Classic thermometer
const mercury = document.getElementById('classicMercury');

// bubble timer
let bubbleTimer = null;


// ---------------------------------------------------
// UTILITY: Map number range to another range
// ---------------------------------------------------
function mapRange(v, a, b, c, d) {
  return c + (d - c) * ((v - a) / (b - a));
}


// ---------------------------------------------------
// MAIN UPDATE FUNCTION
// ---------------------------------------------------
function updateFromTemp(t){
  tempLabel.textContent = Math.round(t);

  // -----------------------------
  // 1. VISCOSITY LOGIC
  // -----------------------------
  const viscosityIndex = 1 - (t / 100); // 0=thin, 1=thick

  let viscLabel =
    viscosityIndex > 0.66 ? 'High (Thick)' :
    viscosityIndex < 0.33 ? 'Low (Thin)' :
    'Medium';

  viscText.textContent = viscLabel;
  viscBadge.textContent = viscLabel;

  // -----------------------------
  // 2. GAS PRESSURE LOGIC
  // -----------------------------
  const pressurePercent = Math.round(mapRange(t, 0, 100, 10, 95));

  pressureFill.style.width = pressurePercent + '%';
  pressureFill.style.background =
    `linear-gradient(90deg, ${pressurePercent>60? '#f94144' : '#ffd166'}, #ff6b6b)`;

  pressurePct.textContent = pressurePercent + '%';

  gasText.textContent =
    pressurePercent > 66 ? 'High' :
    pressurePercent < 33 ? 'Low' :
    'Medium';

  // -----------------------------
  // 3. LAVA STEM LOGIC
  // -----------------------------
  const stemHeight = Math.round(mapRange(t, 0, 100, 80, 10));
  lavaStem.style.height = stemHeight + 'px';

  // lava color warmth
  const warm = Math.round(mapRange(t, 0, 100, 40, 255));
  lavaStem.style.background =
    `linear-gradient(rgb(${warm},90,20), rgb(${warm-30},20,0))`;

  // -----------------------------
  // 4. LAVA FLOW LOGIC
  // -----------------------------
  const flowOpacity = mapRange(t, 0, 100, 0.08, 0.98);
  const flowHeight = Math.round(mapRange(t, 0, 100, 40, 160));
  const flowWidth = Math.round(mapRange(t, 0, 100, 58, 32));
  lavaFlow.style.opacity = flowOpacity;
  lavaFlow.style.height = flowHeight + 'px';
  lavaFlow.style.width = flowWidth + 'px';
  lavaFlow.style.borderRadius =
    Math.max(10, Math.round(flowWidth/2)) + 'px';

  lavaFlow.style.background =
    `linear-gradient(#ffb37a, rgb(${warm},60,20) 70%)`;

  // -----------------------------
  // 5. BUBBLES
  // -----------------------------
  setupBubbles(t, pressurePercent, viscosityIndex);

  // -----------------------------
  // 6. CLASSIC THERMOMETER
  // -----------------------------
  const mercuryHeight = t + "%";
  mercury.style.height = mercuryHeight;

  // glow on high temp
  mercury.style.boxShadow =
    t > 75
      ? "0 0 15px rgba(255,0,0,.8)"
      : "inset 0 0 8px rgba(0,0,0,0.5)";
}


// ---------------------------------------------------
// BUBBLE SYSTEM
// ---------------------------------------------------
function clearBubbles(){
  if(bubbleTimer){
    clearInterval(bubbleTimer);
    bubbleTimer = null;
  }
  bubbles.innerHTML = '';
}

function spawnBubble(temp, pressure, viscosityIndex){
  const el = document.createElement('div');
  el.className = 'bubble';

  // bubble size
  const size = Math.round(mapRange(temp, 0, 100, 14, 6));
  el.style.width = size + 'px';
  el.style.height = size + 'px';

  // drift left/right
  const drift = Math.round((Math.random() - 0.5) * 60);
  el.style.setProperty('--drift', drift + 'px');

  // speed
  const dur = mapRange(temp, 0, 100, 4200, 900);
  el.style.animationDuration = (dur/1000) + 's';

  // bubble starting position
  const offset = Math.round((Math.random()-0.5) * 80);
  el.style.left = (50 + offset/1.6) + '%';

  bubbles.appendChild(el);

  // remove when done
  setTimeout(() => el.remove(), dur + 200);
}

function setupBubbles(temp, pressurePercent, viscosityIndex){
  clearBubbles();

  const interval = Math.max(120,
    Math.round(mapRange(pressurePercent, 0, 100, 1400, 200))
  );

  const perTick = Math.max(1,
    Math.round(mapRange(temp, 0, 100, 1, 4))
  );

  bubbleTimer = setInterval(() => {
    for(let i=0;i<perTick;i++){
      spawnBubble(temp, pressurePercent, viscosityIndex);
    }
  }, interval);
}


// ---------------------------------------------------
// INITIALIZE
// ---------------------------------------------------
updateFromTemp(parseInt(tempRange.value, 10));


// ---------------------------------------------------
// EVENT LISTENER
// ---------------------------------------------------
tempRange.addEventListener('input', e => {
  const t = Number(e.target.value);
  updateFromTemp(t);
});
</script>

</body>
</html> 
